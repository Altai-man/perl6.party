%% title: Exploiting Perl 6 Mixins For Fun And Profit
%% date: 2016-06-27
%% desc: Mixing in roles into core objects to inject malicious code from a distance
%% draft: True

Back when I wrote about [exploiting operators made of invisible Unicode
chars](http://perl6.party/post/Anguish--Invisible-Programming-Language-and-Invisible-Data-Theft),
a bunch of folks pointed out the module containing rogue
code would actually have to be imported by the victim. Fair enough! Today,
we'll step it up a notch!

## The Game Plan

We all worked on codebases that relied on a dozen of open-sourced modules,
each of which relied on a few more, which in turn... well, you get the point.
Somewhere a gazillion levels deep there's some type of a
[leftpad](http://www.theregister.co.uk/2016/03/23/npm_left_pad_chaos/) in use
that you never review for sanity. Right?

So here's our setup:

    +--------------+     +-------------+    +------------+
    | Rightpad.pm6 |  -> | GoodGuy.pm6 | -> | Target.pm6 |
    +--------------+     +-------------+    +------------+

`Target.pm6` is some code we want to steal stuff from. It uses
`GoodGuy.pm6` to bring in some functionality, and somewhere down
`GoodGuy.pm6`'s dependency chain there's `Rightpad.pm6` that we'll
modify and hope no one will notice.

## Augmented Reality

The first thing one might think about when trying to change stuff in the
entire app is core type augmentation. Let's try it out:

    use MONKEY-TYPING;
    augment class Str { method uc {} }

    # ===SORRY!=== Error while compiling /home/zoffix/CPANPRC/temp.p6
    # Package 'Str' already has a method 'uc' (did you mean to declare
    # a multi-method?)
    # at /home/zoffix/CPANPRC/temp.p6:2

We `use` the `MONKEY-TYPING` pragma to acknowledge we're doing Dangerous
Thingsâ„¢ and then try to replace an already-existing `uc` method on `Str` type.

Oops! We get an error saying it already exists.
